#!/bin/bash

POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")
OUTPUT_DIR="pokemon_data_parallel"
ERROR_LOG="errors.txt"

mkdir -p "$OUTPUT_DIR"

fetch_pokemon() {
    name=$1
    url="https://pokeapi.co/api/v2/pokemon/$name"
    output_file="$OUTPUT_DIR/${name}.json"
    retries=0
    success=0

    while [ $retries -lt 3 ]; do
        response=$(curl -s -w "%{http_code}" -o "$output_file" "$url")
        if [ "$response" -eq 200 ]; then
            echo "Saved data to $output_file ✓"
            success=1
            break
        else
            retries=$((retries + 1))
            echo "Attempt $retries failed for $name (HTTP $response), retrying..."
            sleep 2
        fi
    done

    if [ $success -eq 0 ]; then
        echo "Failed to fetch $name after 3 attempts" >> "$ERROR_LOG"
        rm -f "$output_file"
    fi
}

# Launch all fetches in parallel
for name in "${POKEMONS[@]}"; do
    fetch_pokemon "$name" &
done

# Wait for all background processes to finish
wait

echo "All Pokémon data fetched in parallel."
